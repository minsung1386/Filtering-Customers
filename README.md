# Filtering Customers (악성 고객 신고 커뮤니티)

## Description
[기사](https://www.youtube.com/watch?v=uD4xbRCqR00)를 보고 이 어플리케이션을 만들기로 결정하였다. 해당 기사는 논란이 되고 있는 배달 어플의 악성 고객들에 관한 것이다. 

최근 여러 온라인 게임에서 소위 ‘핵’이라고 부르는 비인가프로그램의 사용을 적발하기 위해 유저들이 직접 신고하고 유저들이 배심원의 역할이 되어 부정행위를 판결하는 시스템을
도입하여 톡톡한 효과를 보고 있다. 이에 착안하여 판매자 (배달 어플의 식당) 들로 하여금 직접 악성 고객들을 신고하고 판결하는 방법을 생각했고 이를 어플로 구현했다.

처음에는 단순히 판매자들이 블랙리스트처럼 악성 고객들의 정보를 공유하며 그 리스트로부터 원하는 정보를 취득할 수 있도록 할 생각이었지만, 고객의 입장에서 정당한 항의일 경우가 존재할 수 있기 때문에 다른 판매자들이 제보 글에 공감 표시를 하고 다른 커뮤니티 사용자들이 이를 확인할 수 있도록 했다.

<br>

## Activity
* __로그인 액티비티 (SignInActivity)__

    서버에 등록된 Id와 password로 로그인할 수 있다. 로그인 정보가 틀렸을 경우, 아래에 메시지를 보여준다.


* __회원가입 액티비티 (CreateAccountActivity)__
    
    새로운 Id와 password를 서버에 등록할 수 있다. 중복되는 id는 허용되지 않는다.

* __메뉴 선택 액티비티 (MenuSelectionActivity)__

    새 게시물을 작성할 지, 기존의 게시물을 검색할 지 결정하는 화면이다.

* __게시물 작성 액티비티 (NewPostActivity)__

    글의 제목, 본문, 신고 대상 닉네임과 전화번호, 첨부 이미지 파일을 선택하여 글을 작성할 수 있다. 글이 작성되면 날짜, 고유id, 글 작성자와 함께 서버에 글이 올라간다. 이 때, 첨부 이미지는 갤러리로부터 불러올 수 있고, Base64로 인코딩되어 등록된다.

* __게시물 검색 액티비티 (ListUpPostActivity)__

    검색하고 싶은 닉네임 혹은 전화번호를 입력하여 서버로부터 해당되는 게시물의 목록을 뽑고 원하는 게시물을 선택하여 볼 수 있다.

* __게시물 보기 액티비티 (ViewPostActivity)__

    검색을 통해 나온 게시물의 본문을 확인할 수 있다. 서버로부터 게시물 정보를 불러와 화면에 나타낸다. 이 때, 첨부된 이미지는 다시 Base64로 디코딩되어 ImageView로 출력된다. 게시물을 보면 해당 게시물의 조회수가 증가하고 공감 혹은 공감하지 않을 수 있다. 이는 Facebook의 ‘좋아요’와 ‘싫어요’와 같은 개념이다. 게시물 보기를 종료하면 해당 공감을 서버에 등록된 게시물에 반영될 수 있도록 했다.

<br>

## Flowchart
<img width="675" alt="스크린샷 2023-04-10 오전 4 23 34" src="https://user-images.githubusercontent.com/50101334/230792855-45d16889-2dab-476d-ab19-fe542f71f594.png">


<br>

## Network API design (AWS lambda – 안드로이드 간 통신 프로토콜)
이 어플리케이션에서 통신은 모두 python의 boto3을 통해 AWS의 S3에 접근하도록 구현했다.

먼저 로그인은 id와 password가 등록되어 있는 파일에 접근하여 매칭이 되는지 확인하는 과정을 거친다. Id와 password가 일치하는지에 대한 flag를 response로 받은 뒤 로그인 시도에 대한 결과를 화면에 출력한다.

회원가입은 해당 파일에 새로운 아이디와 비밀번호를 등록한다. 이 때, 이미 존재하는 id와 중복되지 않도록 한다. 이 때 s3는 이미 서버에 올라간 파일 내부에 대한 수정이 불가능하기 때문에 같은 이름의 파일을 새로 작성하여 덮어씌우도록 처리했다.

게시물을 작성하면 s3 client의 put_object를 통해 게시물의 내용들과 작성자 이름, 게시물 고유 id, 날짜와 함께 json형식으로 POST method를 통해 서버에 등록된다.

게시물을 이름과 번호로 검색하면 먼저 모든 게시물을 돌며 이름과 전화번호가 매치되는 게시물의 key값을 받아온다. 이후, key값을 통해 get_object로 게시물을 가져온 뒤에 검색 결과로 보여줄 작성 날짜, 제목, 조회수로 이루어진 json obejct의 배열, 즉 jsonArray형식으로 결과를 반환한다.

검색 결과를 통해 나온 게시물을 확인하면 앞서 받아온 해당 게시물의 key값을 통해 get_object로 게시물 정보를 가져온다. 게시물 확인을 종료하면 글의 조회수, 공감을 반영하기 위해 다시 서버에 있는 게시물을 업데이트한다. 이는 액티비티의 onDestroy()함수 오버라이드를 통해 구현했다.

<br>

## Challenge
* __MVVM 패턴__
    
    이 프로젝트의 가장 어려웠던 점이자 핵심이라고 느꼈다. 프로젝트를 수행하며 단순히 안드로이드 어플 개발뿐 아니라 MVP, MVVM과 같은 실제로 상용화된 아키텍처 패턴을 익히기 위함이었다.

    하나의 액티비티에서 모든 동작을 수행하던 것을 View, ViewModel, Model로 나누고 각자의 역할을 이해하는 것부터 데이터 바인딩을 이용해 서로 간의 의존성을 없애는 것까지 모두 시간이 많이 소요됐다.

* __이미지 저장, 화면 출력__

    이미지를 json과 같은 문자열 기반 데이터 안에 저장하기 위해 Base64로 인코딩하여 저장하고 불러올 땐 디코딩하는 과정을 거쳤다. 그리고 앞선 MVVM 패턴과 연관이 되기도 하지만 디코딩하여 데이터 바인딩과 Binding Adapter를 이용해 ImageView로 출력하는 과정은 깊은 이해와 많은 시간을 요구했다.

<br>

## Appendix

__MVVM 패턴__

이 어플리케이션에는 앞서 기술한 것처럼 MVVM 패턴을 사용했다.

__Model__ 은 오직 데이터만 가지고 있도록 구현했다.

__View__ 는 UI와 필수적인 UI 로직으로 구성했다. 여기서 UI는 화면에 보이는 요소들을 의미하고 UI 로직은 Context를 필요로 하는 동작이다. 한 액티비티에서 다른 액티비티를 실행하거나, 갤
러리로부터 이미지를 불러오는 동작은 그 액티비티의 Context를 필요로 한다. 하지만 ViewModel이 액티비티의 Context를 가지고 있으면 memory leak와 같은 문제가 발생할 수 있
다. 따라서 ViewModel이 View로 하여금 startActivity와 같은 함수를 호출하도록 했다.

__ViewModel__ 은 앞서 기술한 UI로직을 제외한 액티비티에서 수행되는 모든 동작을 처리하도록 했다. 데이터로는 Model의 인스턴스, Model을 UI에 구성하기 위한 필수적인 데이터, UI로부터
전달되는 input data 등을 가지며, 로직으로는 Http통신, Model 업데이트, UI 수정 등을 가진다. 이 때, UI로부터 전달되는 input 데이터는 Data Binding을 통해 ViewModel로 전달되도록 했고
ViewModel은 전달받은 데이터를 Model에 업데이트하도록 했다.
